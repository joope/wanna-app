<!--navbar menu-->
<div class="topmargin"></div>
<!--<nav class="navbar navbar-default sporttimenu navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="glyphicon glyphicon-menu-hamburger"></span>
            </button>
            <a class="navbar-brand" href="#/" ng-bind="title"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#/calendar">Tapahtumat</a></li>
                <li><a href="#/events">Suositukset</a></li>
                                <li class="dropdown">
                    <a href="#/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Ilmoitukset <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <button ng-repeat="ntf in notifications | orderBy:'-createdAt' | limitTo:20" type="button" class="list-group-item list-group-item-{{ntf.type}}">
                            {{ntf.message}} <span class="pull-right">({{ntf.createdAt | date:'d.M. H:mm'}})</span>
                        </button>
                    </ul>
                </li>
            </ul>
        </div>/.nav-collapse 
    </div>
</nav>-->
<nav class="navbar sporttimenu navbar-fixed-top">
    <ul>
        <li><a href="#/events">Suositukset</a></li>
        <li class="dropdown pull-right">
            <a href="#/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-globe"></span></a>
            <ul class="dropdown-menu">
                <button ng-repeat="ntf in notifications| orderBy:'-createdAt' | limitTo:10" type="button" class="list-group-item list-group-item-{{ntf.type}}">
                    {{ntf.message}} <span class="pull-right">({{ntf.createdAt| date:'d.M. H:mm'}})</span>
                </button>
            </ul>
        </li>
        <li class="pull-right"><a href="#/calendar"><span class="glyphicon glyphicon-calendar"></span></a></li>
    </ul>
</nav>
<!--notification-box-->
<div class="notification animate-show" ng-show="notification">{{notification}}
    <button class="close" ng-click="notification = ''">x</button>
</div>
<!--the rest-->
<div class="lomake">
    <div class='animate-show' ng-show='userLoggedIn'>
        <!-- Search bar -->
        <h1 class="searchHeader">Mitä haluaisit tehdä?</h1>
        <div>
            <form name="wannaForm" class="form-group">
                <div class="input-group">
                    <input type="text" class="form-control " ng-model='search' maxlength="25" ng-change="searched(search)"
                           placeholder="esim. sulkapallo, tänään, helsinki" autofocus>
                    <!--                    <span class="input-group-btn">
                                            <button class="btn remove-btn " ng-click="search = ''" type="button"> 
                                                x
                                            </button>
                                        </span>-->
                    <span class="input-group-btn">
                        <button class="btn btn-add" ng-click="toggleForm()" data-toggle="modal" data-target="#modal" type="submit">  +  
                        </button>
                    </span>
                </div>
            </form>

            <!--search results-->
            <div id="searchbar" class="list group">
                <div class="event_wrapper"  ng-repeat="event in results = (eventList| filter: search | orderBy:'date' | limitTo:20)">

                    <!--date header bar-->
                    <div ng-show="dateChanged(event.date) || results.length === 1" class="otsikko">
                        {{dateToRelative(event.date)}} {{event.date| date:'d.M'}}
                    </div>

                    <!--event name and basic info-->
                    <a href="#/" type="button" class="list-group-item"
                       ng-class="{'event-clicked' : event.clicked , '' : !event.clicked}"
                       ng-click="eventClicked(event)">
                        <h4 class="list-group-item-heading">{{event.name}}
                            <!--                            <strong class=pull-right">{{event.date| date:'H:mm'}}</strong>-->
                            <!--                            <button type="button" class="btn btn-xs menuikoni">
                                                            <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
                                                        </button>-->

                            <span class="badge pull-right"
                                  ng-class="{'badge-info': event.currentSize > 1 && !event.ready, 'badge-success': event.ready}">
                                {{event.currentSize}}/{{event.minSize}} 
                            </span>

                        </h4>
                        <p class="list-group-item-text">{{event.place}}
                            <span class="pull-right"><strong>{{event.date| date:'H:mm'}}</strong></span>
                        </p>
                    </a>
                    <!--info wrapper for event-->
                    <div ng-show="event.clicked" class="list-group-item animate-show info-wrapper">
                        <p class="list-group-item-text">
                            <strong>Lisätietoja:</strong> {{event.info}}
                        </p>
                        <p class="list-group-item-text">
                            <strong>Osallistujat:</strong> {{event.userList}}
                        </p>
                        <div class="event_info">
                            <button class="btn btn-success btn_join" type="button" ng-if="!event.joined" ng-click="join(event)" >liity
                            </button>
                            <button class="btn btn-warning btn_join" ng-disabled="event.ready || event.currentSize >= event.minSize" type="button" ng-if="event.joined" ng-click="join(event)" >lähde
                            </button>
                        </div>
                    </div>
                </div>
                <button ng-show="results.length == 0" ng-click="toggleForm(wanna)" 
                        data-toggle="modal" data-target="#modal" type="button" class="list-group-item list-group-item-info">
                    Ei tulevia tapahtumia "{{search}}", lisää klikkamalla tästä
                </button>
            </div>
        </div>
    </div>
</div>

<!-- modal form for adding events -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="newEventForm">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form name="eventFrom">
                <div class="modal-header">
                    <button type="button" class="pull-right btn btn-default btn-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">sulje</span></button>
                    <h4 class="modal-title text-center" id="exampleModalLabel">Uusi tapahtuma</h4>
                </div>
                <div class="modal-sisalto">
                    <label for="modal-name" class="control-label">Tapahtuman aihe:</label>
                    <input type="text" autocomplete="off" class="form-control valikko" id="modal-what" placeholder="esim lenkkeily, leffan katsominen..." ng-model="what" maxlength="30" 
                           ng-focus="searching = true" ng-blur="searching = false" focus-me="formToggled" required>

                    <!-- Lista tekemisen kohteista -->
                    <div class="" ng-show="searching">
                        <div class="valikko-container">
                            <button type="button" ng-show="searching" class="list-group-item valikko-item" 
                                    ng-repeat="wanna in wannaList| filter:{name: what} | orderBy:'-popularity' | limitTo:5"
                                    ng-mousedown="selectWanna(wanna)">{{wanna.name}}
                            </button>
                        </div>
                    </div>
                    <label for="modal-name" class="control-label">Sijainti:</label>
                    <input type="text" class="form-control" id="modal-place" placeholder="esim Unisport Kumpula" ng-model="place" maxlength="30" required>
                    <div class="row">
                        <div class="col-xs-12">
                            <label for="modal-name" class="control-label">Päivämäärä:</label>
                            <datepicker date-set="{{date.toString()}}" datepicker-show="true"
                                        date-min-limit="{{getPreviousDate()}}" date-format="EEEE dd.MM.yyyy" >
                                <input class="form-control" ng-model="datepicked" type="text" maxlength="30"/>
                            </datepicker>
                            <p ng-show="dateError">{{dateError}}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-3">
                            <label for="modal-name" class="control-label">Aika:</label>
                            <input type="time" class="form-control" ng-model="time" required>
                        </div>
                        <div class="col-xs-8 col-xs-offset-1">
                            <label for="modal-min" class="control-label">Tarvittavat osallistujat:</label>
                            <div>
                                <input type="number" class="form-control numerovalitsin" placeholder="min-osallistujat" 
                                       min="2" max="50" ng-model="minSize">
                                <button type="button" class="btn btn-default inline-block" ng-click="minSize = minSize - 1"> - </button>
                                <button type="button" class="btn btn-default inline-block" ng-click="minSize = minSize + 1"> + </button>
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <!--                        <div class="col-xs-5">
                                                    <label for="modal-min" class="control-label">max-osallistujat: </label>
                                                    <input type="number" class="form-control numerovalitsin" placeholder="max-osallistujat" 
                                                           min="2" max="100" ng-model="maxSize">
                                                    <button class="btn vahennyspainike inline-block" ng-click="maxSize = maxSize - 1"> - </button>
                                                    <button class="btn lisayspainike inline-block" ng-click="maxSize = maxSize + 1"> + </button>
                                                </div>-->
                    </div>

                    <!--                    <input type="radio" name="julkinen" ng-value="false" ng-model="private" checked> julkinen <br>
                                        <input type="radio" name="yksityinen" ng-value="true" ng-model="private"> yksityinen 
                                        
                    --><div class="">
                        <label for="modal-information" class="control-label">Lisätietoja (valinnainen):</label>
                        <textarea class="form-control" id="modal-information" maxLength="128" ng-model="info"></textarea>
                    </div> 
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-success btn_join" ng-click="newEvent()" ng-disabled="minSize < 2 || !place || !date || !what" data-dismiss="modal">Lisää</button>
                </div>
            </form>
        </div>
    </div>
</div>